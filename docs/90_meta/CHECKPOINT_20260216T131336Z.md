# CHECKPOINT — appsicologa.cl (infra + tunnel provisório)
TS_LOCAL: 2026-02-16T10:13:36-03:00
TS_UTC: 2026-02-16T13:13:36+00:00

## Infra — status atual
### Porta 9090
- cockpit.socket: **masked** (liberou :9090)

### Nginx (HTTP)
- Nginx: ativo
- VHost: /etc/nginx/sites-available/appsicologa.cl.conf (enabled)
- Web root: /var/www/appsicologa.cl/public (index.html placeholder)
- Testes OK:
  - curl com Host=appsicologa.cl em http://127.0.0.1 -> 200

### Cloudflare Tunnel (provisório via brotherdrive.app)
- Tunnel: **appsicologa**
- ID: 4e254e05-a9be-4636-8a4c-a7cc78fbf5f3
- Config: /etc/cloudflared/config.yml
- Service: cloudflared.service **enabled + active**
- Hostnames publicados:
  - https://appsicologa.brotherdrive.app (OK)
  - https://www-appsicologa.brotherdrive.app (OK)
- Nota TLS: **www.appsicologa.brotherdrive.app** (2 níveis) não funciona com Universal SSL padrão.

### DNS local (fix)
- Criado: appsicologa-dns-pin.service
- Ação: fixa DNS do link enp2s0 para **1.1.1.1 / 1.0.0.1** + flush caches
- Motivo: resolver local estava retornando NXDOMAIN/cache negativo para www-appsicologa

## Rollback rápido
- DNS pin:
  - sudo systemctl disable --now appsicologa-dns-pin.service
  - sudo rm -f /etc/systemd/system/appsicologa-dns-pin.service && sudo systemctl daemon-reload
  - sudo resolvectl revert enp2s0
- Cloudflare:
  - sudo systemctl disable --now cloudflared.service
- Cockpit (se quiser voltar):
  - sudo systemctl unmask cockpit.socket && sudo systemctl enable --now cockpit.socket

## Próximo passo
- Ajustar o **server_name** do Nginx para incluir:
  - appsicologa.brotherdrive.app
  - www-appsicologa.brotherdrive.app
(para não depender de “first vhost wins” quando existir mais sites)
